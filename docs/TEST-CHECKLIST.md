# Test Checklist (K3s-only)

- [ ] Run quick-deploy: `./nixos-quick-deploy.sh`
- [ ] K3s running: `sudo systemctl status k3s --no-pager`
- [ ] Pods healthy: `kubectl get pods -n ai-stack`
- [ ] Optional agents disabled by default (aider/autogpt/open-webui at 0 replicas unless explicitly enabled)
- [ ] Optional agents (dev): `kubectl apply -k ai-stack/kustomize/overlays/dev-agents` then `kubectl exec -it deploy/aider -n ai-stack -- bash`
- [ ] AI stack health: `./scripts/ai-stack-health.sh`
- [ ] TLS log scan: `./scripts/check-tls-log-warnings.sh`
- [ ] Timeout lint (non-blocking): `./scripts/lint-timeouts.sh`
- [ ] Restore drill (optional, safe by default): `./scripts/restore-drill.sh`
- [ ] Acceptance checks (optional): `RUN_NETPOL_TEST=true RUN_REGISTRY_TEST=true RUN_DASHBOARD_TEST=true ./scripts/run-acceptance-checks.sh`
- [ ] Firewall/ingress audit (optional): `./scripts/firewall-audit.sh`
- [ ] Podman TCP bound to localhost (optional): `ss -tulpn | rg ':2375'` should show `127.0.0.1:2375`
- [ ] Kustomize server dry-run (optional): `kubectl apply -k ai-stack/kubernetes/kompose --dry-run=server`
- [ ] Integration tests: `RUN_K3S_INTEGRATION=true ./tests/run-integration-tests.sh`
- [ ] NetworkPolicy enforcement (optional): `RUN_K3S_INTEGRATION=true RUN_NETPOL_TEST=true ./tests/run-integration-tests.sh`
- [ ] Buildah/Skopeo workflow (optional): `sudo BUILD_TOOL=buildah ./scripts/build-k3s-images.sh` (or `BUILD_TOOL=buildah SKIP_K3S_IMPORT=true ./scripts/build-k3s-images.sh`) then `CONTAINER_CLI=skopeo ./scripts/publish-local-registry.sh`
- [ ] Endpoint audit (optional): `./scripts/audit-service-endpoints.sh` (should report zero hardcoded localhost URLs)
- [ ] Cilium FQDN egress policy (optional): `kubectl apply -f ai-stack/kubernetes/network-policies/ai-stack-allow-external-fqdn.yaml`
- [ ] Phase 9 gate-only checks (optional): `RUN_K3S_INTEGRATION=true RUN_PHASE_09_GATE_TEST=true ./tests/run-integration-tests.sh`
- [ ] AIDB health: `kubectl port-forward -n ai-stack svc/aidb 8091:8091` then `curl http://localhost:8091/health`
- [ ] Hybrid health: `kubectl port-forward -n ai-stack svc/hybrid-coordinator 8092:8092` then `curl http://localhost:8092/health`
- [ ] Dashboard API NodePort (dev): `curl http://localhost:31889/api/health`
- [ ] Dashboard API WebSocket (dev): `curl -i --max-time 3 -H 'Connection: Upgrade' -H 'Upgrade: websocket' -H 'Sec-WebSocket-Key: test' -H 'Sec-WebSocket-Version: 13' http://localhost:31889/ws/metrics | head -n 1` â†’ `HTTP/1.1 101`
- [ ] E2E test: `python3 ai-stack/tests/test_hospital_e2e.py`
